
.. _ispolzovanie-sistemyi-razdel-polzovateli-i-tarifyi:

===================================
4.15 Раздел «Пользователи и тарифы»
===================================


С помощью данного раздела производится управление тарифными планами (ТП) и
учетными записями (аккаунтами) пользователей. Понятия тарифного плана и
аккаунта – важные элементы биллинг-системы.



4.15.1 Назначение и особенности
===============================


В соответствии правилами, потребляемый пользователями трафик относится
системой к одной либо нескольким категориям (классам) для удобства
тарификации и учета.



Разделение на классы трафика используется для списания денег за трафик,
установки лимитов его потребления, а также в подсистеме статистики и создания
отчетов. Expert Billing System позволяет гибко разделять трафик по классам в
зависимости от направления (входящий/исходящий), сетей отправителя и
получателя, используемых протоколов, портов и т.д.



Статистика о трафике считается принадлежащей классу, если её параметры (порт,
протокол, адрес и  т.п.) соответствуют хотя бы одному из правил подклассов
данного класса. Трафик, не попавший под описание ни одного из классов, в базу
данных не записывается.



В системе Expert Billing System каждый класс имеет уникальный порядковый
номер. Сравнение статистики с классами происходит от меньшего класса к
большему (сверху вниз). Для повышения либо понижения веса класса используются
кнопки «Повысить» и «Понизить» на панели.



После того, как записи статистики («трафик») попадают под описание класса,
поиск других классов, которым она может также соответствовать, не
производится. Однако если в опциях класса указано «Пометить и продолжить», то
поиск соответствий продолжается до тех пор, пока не обнаружится соответствия
трафика классу с отключенной опцией «Пометить и продолжить».



4.15.2 Интерфейс и логика
=========================


Элементы раздела «Отчёты» доступны только через меню «Отчёты»;



При выборе в меню необходимого типа отчета, открывается соответствующее
рабочее окно.



.. image:: _images/ebs_182.png
    :alt: ebs_182




Большую часть окна занимает рабочее поле, куда будет выведен текст и графика
отчета, остальное – панель управления с двумя кнопками, «Конфигурировать» и
«Печатать».



Окно «Настройки отчета»



Окно «Настройки отчета» (открывается по нажатию кнопки «Конфигурировать»)
имеет стандартный вид и может содержать от одной до четырех нескольких
вкладок. На первой вкладке («Общее») представлены стандартные настройки
отчета. В зависимости от типа отчета некоторые элементы и группы элементов
могут быть недоступны.



.. image:: _images/ebs_183.png
    :alt: ebs_183




Группа «Данные» позволяет выбрать, чем будет измеряться потребление в отчете:
скоростью канала или использованным трафиком.



В группе «Внешний вид» настраивается сглаживание точек результирующих
графиков (флажок  «Сглаживание») и возможность построения дополнительных
вспомогательных линий на графике («Сетка»).



«Группировать по…» – флажки в этом блоке предназначены для группирования
наиболее популярных (или же активных)  клиентов, групп и классов трафика, а
также сетевых серверов.



«Трафик» – в этом блоке выбирается, какой трафик будет считаться: входящий,
исходящий, наибольший или  суммарный.



В зависимости от типа отчета на дополнительных вкладках предлагается выбрать
пользователей, участвующих в формировании отчета, а также серверы доступа или
обрабатываемые классы трафика.



4.15.2.1 Тарифы
===============


Окно «Настройки тарифного плана»



Данное окно вызывается при нажатии кнопки «Добавить тариф» а также при
редактировании свойств уже существующих тарифных планов (двойной щелчок по
названию тарифа, либо пункт «Редактировать тариф» в контекстном меню).



.. image:: _images/ebs_203.png
    :alt: ebs_203




На нескольких вкладках задаются настройки различных компонентов тарифов
(оплата за время, оплата за трафик, включенные в тарифный план разовые и
периодические услуги, лимиты трафика, подключаемые услуги).



Вкладка «Общее»



Здесь задаются основные параметры и компоненты тарифного плана.



«Название тарифного плана» - Название ТП  не может быть пустым либо превышать
255 символов. Название также не должно повторяться.



«Фиксированный расчетный период для данного тарифа» -  Использовать для
тарифа выбранный расчетный период. Становится активной группа настроек
расчетного периода: возможность определить срок действия пакета, его
стоимость и особенности расчетов с абонентом.



При установке флажка «Начать при активации у пользователя данного тарифного
плана», в выпадающем списке «Расчетный период» будут доступны лишь расчетные
периоды, автоматически активирующиеся при назначении пользователю этого
тарифного плана (со знаком «+» в названии, например «+Неделя»). Если флажок
не установлен, то в списке будут доступны лишь расчетные периоды,
начинающиеся и заканчивающиеся  одновременно для всех аккаунтов тарифного
плана. Работа с расчетными периодами производится в соответствующем разделе.



Обратите внимание: использовать фиксированный расчётный период имеет смысл
только в том случае, если вам потребуется сбрасывать/начислять предоплаченный
трафик/время, а также производить доснятие средств до стоимости тарифного
плана или требовать наличия суммы тарифного плана на счету абонента в начале
расчётного периода.



«Стоимость пакета» - стоимость тарифного плана на расчётный период. Имеет
смысл указывать в комбинации с нижеследующими двумя опциями и в информативных
целях.



Если флажок «Производить доснятие суммы до стоимости тарифного плана»
установлен, то даже в том случае, если пользователь к моменту завершения
расчетного периода не потребил услуг на сумму стоимости пакета, с его счёта
доснимется сумма, равная разнице между суммой потреблённых услуг в рамках
тарифного плана и стоимостью пакета.



«Требовать наличия всей суммы» - если установлена эта опция, то при
наступлении нового расчётного периода система будет проверять есть ли у
абонента на балансе необходимая сумма. В случае, если суммы не хватает,
клиент будет заблокирован, о чём будет выведено соответствующее
предупреждение в его веб-кабинете. Данная блокировка влияет только на
возможность авторизации абонента.



Группа «Набор компонентов» позволяет выбрать, какие компоненты  будут
использованы в данном тарифном плане. Могут использоваться ограничения
абсолютных величин трафика (вкладка «Лимиты»), определена стоимость и время
действия периодических услуг (вкладка «Периодические услуги»), список
доступныых для самостоятельного подключения подключаемых услуг, указаны
доступные для пользователя разовые услуги (вкладка «Разовые услуги»), а также
установлены модели тарификации по времени (вкладка «Оплата за время») и/или
по трафику (вкладка «Оплата за трафик»). Компоненты действуют на учетную
запись независимо друг от друга. Чтобы задействовать тот или иной компонент
тарифного плана, установите соответствующий флажок в группе и перейдите на
нужную вкладку для настройки компонента.



Выпадающий список «Способ доступа» позволяет определить технологию доступа:
PPTP, PPPOE, IPN либо HotSpot.



Обратите внимание: выбрав технологию доступа IPN (по IP) или HotSpot, в
дальнейшем вы не сможете её изменить для данного тарифного плана. Аналогично,
при настройке созданного на PPTP/PPPOE тарифного плана, изменить технологию
доступа на IPN вы также не сможете.



«Производить IPN действия» – для подключений по PPTP/PPPOE разрешается
выполнение IPN-действий (управление на сервере доступа списками доступа для
пользователей с VPN-тарифами так же, как для пользователей IPN).



Обратите внимание: Обновление информации в ACL о состоянии пользователей
происходит спустя 1-3 минуты после изменения данных.



В выпадающем списке «Время доступа» выбирается требуемый период тарификации,
в течение которого абонентам разрешено пользоваться услугами. При выходе из
разрешённых временных рамок на сервер доступа будет послана команда для
разрыва PPPOE/PPTP/HotSpot сессии и отключения нужного ACL при способе
доступа IPN.



«Разрешить активацию карт экспресс-оплаты» – установленный флажок разрешает
пользователям тарифного плана пополнять лицевой счет с помощью карт
экспресс-оплаты. Управление картами экспресс-оплаты производится в разделе
«Карты экспресс-оплаты» (см. соответствующий раздел).



«Активен» – установленный флажок делает тарифный план активным. Пользователи
из неактивного тарифного плана не смогут авторизоваться на RADIUS сервере и
станут неактивны в ACL на сервере доступа. Текущие сессии будут разорваны. На
списание средств деактивация тарифного плана никак не влияет.



Вкладка «Настройки скорости»



На этой вкладке в полях группы «Настройки скорости по умолчанию» (верхняя
часть диалогового окна) устанавливаются ограничения скорости для
пользователей тарифного плана. В таблице (нижняя часть диалогового окна)
производятся ограничения скорости для различных периодов тарификации. Кнопка
«+» добавляет строку к концу таблицы, «–» удаляет выбранную строку.



Указанные в полях группы «Настройки скорости по-умолчанию» величины
наследуются в таблице, однако у приведенного в таблице значения приоритет
выше. Например, если в группе «Настройки скорости по умолчанию» задано
значение максимальной скорости 128 Кбит/с, а в таблице для определенного
периода – 256 Кбит/с, то в течение указанного периода будет действовать
ограничение 256 Кбит/с, а в остальное время – 128 Кбит/с.



При выборе конкретного правила для скорости выбирается тот период
тарификации, у которого самый короткий временной промежуток из всех, попавших
в данный период времени. Например, если в настройках скорости указаны
значения для периода «Неделя» и периода «Вторник», то во вторник сработает
именно правило для «Вторника».



Если в таблице для какого-либо периода тарификации указана скорость 0, то это
означает отсутствие ограничений скорости. По умолчанию, ограничения скорости
отсутствуют.



Если в таблице соответствующая клетка пуста, то это значит, что для данного
случая будут действовать  ограничения, указанные в  группе «Настройки
скорости по-умолчанию»).



.. image:: _images/tarif_2.png
    :alt: tarif_2




Пять полей в столбце «OUT» означают ограничения, относящиеся к исходящему
направлению трафика (относительно пользователя), а в столбце «IN» – ко
входящему. Скорость указывается в битах в секунду. Сокращение «k» (например,
«256k») означает умножение значения скорости на 1000, итоговый результат
представляется в битах/секунду («256к» = 256000 бит/с). Сокращение «M»
(например, «2M») означает умножение значения скорости на 1000000, результат
представляется в битах/секунду («2М» = 2000000 бит/с).



Описание параметров, связанных с настройками скорости:



MAX – максимальная скорость передачи данных для пользователей данного
тарифного плана. Может быть превышена только при исполнении условий выхода на
пиковую скорость («Burst», см ниже) Значение «0» означает отсутствие
ограничений максимальной скорости.



MIN – минимальная (гарантированная) скорость передачи данных.



Burst – входит в серию параметров, устанавливающих условия и свойства
перехода на пиковую скорость для пользователя (Burst). Определяет величину
этой скорости. Значение «0» означает отсутствие ограничений.



Burst Threshold– определяет пороговое значение средней скорости за период
Burst Time, необходимое для включения либо отключения пиковой скорости
(Burst).



Burst Time – определяет период Burst Time, за который при работе со скоростью
выше либо ниже Burst Threshold будет произведен переход на пиковую  скорость
(Burst) либо прекращено её действие.



Priority – параметр приоритета определяется цифрой от 1 до 8 и указывает
право передаваемого пакета на первоочередной доступ к среде передачи. Самый
высокий приоритет – 1, самый низкий – 8.



Период тарификации – в графе «Время» каждой строчки таблицы можно выбрать
один из периодов тарификации, которые задаются в отдельном разделе. Таким
образом, вводится возможность гибкого управления скоростью в зависимости от
дня и времени суток.



Обратите внимание: необходимо внимательно отнестись к указанию скорости и
обязательно проверить все условия на корректность. В случае возникновения
недопустимых коллизий (MIN>MAX, Burst<MAX и т.д.)  абоненты не смогут пройти
аутентификацию на сервере доступа (VPN-тарифы) либо будут работать без
ограничений скорости (IPN-тарифы).



Обратите внимание: для PPTP/PPPOE/HotSpot-тарифных планов первоначальная
установка скорости клиента происходит при аутентификации на RADIUS-сервере
методом подстановки параметров $max_limit_rx, $max_limit_tx, $burst_limit_rx,
$burst_limit_tx, $burst_treshold_rx, $burst_treshold_tx, $burst_time_rx,
$burst_time_tx, $priority, $min_limit_rx, $min_limit_tx в форматную строку из
RADIUS настроек сервера доступа.

.. image:: _images/nas_radius_speed.png
    :alt: nas_radius_speed


Настройки форматной строки для установки скорости через RADIUS атрибуты



Команды на изменение скорости в момент существования сессии посылаются из
ядра (core) при помощи подстановки параметров в форматную строку, указанную в
настройках сервера доступа. Для IPN-тарифов все команды управления скоростью
отсылаются только из ядра.



.. image:: _images/nas_speed_vpn.png
    :alt: nas_speed_vpn


Форматная строка, для установки скорости через SSH из ядра.



Вкладка «Оплата за трафик»



На данной вкладке указывается стоимость мегабайта трафика в зависимости от
периода тарификации и группы трафика, а также настройки предоплаченного
трафика.



.. image:: _images/tarif_traffic_cost.png
    :alt: tarif_traffic_cost


Тарификация за трафик.



При выборе цены за мегабайт для трафика, попавшего в тарифицируемую группу,
из всех строк выбирается та, у которой самый короткий временной промежуток из
всех, попавших в данный период времени. Например, если есть период «Неделя» с
настройками скорости и есть период «Вторник», то во вторник сработает именно
правило для периода «Вторник».



Группа трафика – объединение нескольких классов трафика  по определенным
признакам. Группы трафика также используются для задания лимитов на тарифных
планах и указания размера предоплаченного трафика.



.. image:: _images/tarif_traffic_group.png
    :alt: tarif_traffic_group


Выбор группы трафика



По щелчку ячейки в графе «Группа» открывается окно управления группами
трафика. Его интерфейс состоит из таблицы со списком существующих в ситеме
групп и кнопок «Добавить группу» и «Удалить группу».  Каждая группа, в
соответствии с наименованиями граф таблицы, определяется названием («Название
группы»), классами трафика, которые в себе объединяет («Классы»),
направлением трафика в классах («Направление») а также методом подсчета
(«Тип»).



.. image:: _images/group_edit.png
    :alt: group_edit


Настройки группы



В классах трафика группы может учитываться входящий либо исходящий трафик,
сумма входящего и исходящего трафика («Сумма Вх + Исх»), либо преобладающий
трафик («Максимальный»): если входящего трафика больше, чем исходящего, то
учитывается входящий трафик, и наоборот. Общее количество трафика в группе, в
зависимости от выбранного типа, может считаться по сумме трафика во всех
классах («Сумма классов»), либо по классу с максимальным объемом трафика
(«Максимальный класс») Например, пусть имеется группа трафика из классов
«Межабонентский трафик» (пользователь потребил на данный момент 200 МБ
входящего и 320 МБ исходящего), «Внешний трафик» (1200 МБ входящего и 200 МБ
исходящего) и «Внутренние ресурсы» (4500 МБ входящего и 120 МБ исходящего).
Если в поле «Направление» выбрано значение «Максимальный», а в поле «Тип» –
«Сумма классов», то суммарное количество учтенного трафика по группе составит
320+1200+4500=6020 МБ.



Объясним действие направления в классах "Максимальный". Приведём пример
поступления статистики в течении 5 минут для одного абонента:



Вх        Исх        Макс

5        10        10

20        3        20

0        1        1

10        3        10

6        8        8

-        -        -

41        25        49



В итоге тарифицироваться будет 49 мегабайт,  а не 41(вх), так как система
определяет максимальное направление при каждом получении статистики в момент
тарификации, а не по факту за весь промежуток работы абонента. Аналогичное
правило действует и для типа группы "Максимальный класс". Будьте внимательны
и острожны при выборе данных опций.



«Предоплаченный трафик» позволяет устанавливать объемы предоплаченного
трафика в рамках пакета.



Установленный флажок «Сбрасывать в конце периода предоплаченный трафик»
позволяет автоматически производить сброс счетчика(-ов) трафика по завершению
очередного расчетного периода.







Обратите внимание: начисление предоплаченного трафика происходит в начале
расчётного периода. Изменение количества предоплаченного трафика в период
между началом и концом расчётного периода актуально только для следующих
расчётных периодов.



Вкладка «Оплата за время»



Элементы вкладки «Оплата за время» становятся доступны для изменения, если на
вкладке «Общее» установлен флажок «Оплата за время». Тарификация времени
может производиться совместно с тарификацией по трафику или любым другим
типом услуги в тарифном плане.



.. image:: _images/ebs_205.png
    :alt: ebs_205




В поле «Предоплачено, с» устанавливается количество нетарифицируемых секунд в
рамках расчетного периода. Установленный флажок «Сбрасывать в конце периода
предоплаченное время» позволяет автоматически производить сброс счетчика(-ов)
времени по завершению очередного расчетного периода.



Тарификация происходит посекундно без округления. Частота списаний зависит от
промежутка между получением Accounting пакетов.



В таблице устанавливается стоимость минуты («Цена») для каждого периода
тарификации. Периоды тарификации не перекрывают друг друга подобно
тарификации трафика





Вкладка «Разовые услуги»



Элементы вкладки «Разовые услуги» становятся доступны для изменения, если на
вкладке «Общее»  установлен флажок «Разовые услуги». В таблице определяются
название (графа «Название») и цена (графа «Стоимость») каждой из таких услуг.



Обратите внимание: стоимость разовых услуг списывается с лицевого счета
только в том случае, если баланс пользователя положительный.



Разовые услуги могут использоваться для списания средств при изменении
тарифного плана как плата за сам факт.



.. image:: _images/ebs_206.png
    :alt: ebs_206




Вкладка «Периодические услуги»

Периодические услуги позволяют списывать с лицевого счёта абонента указанные
суммы с интервалом в расчётный период. В большинстве случаев периодчеиские
услуги являются абонентской платой за какие-либо оказываемые услуги будь то
обслуживание линии, доступ в интернет и др.

Элементы вкладки «Периодические услуги» становятся доступны для изменения,
если на вкладке «Общее»  установлен флажок «Периодические услуги». В таблице
можно указать название (графа «Название») и цену (графа «Стоимость») для
каждой из таких услуг, а также расчетный период, в рамках которого услуга
будет действовать (графа «Период», управление расчетными периодами
осуществляется в разделе «Расчетные периоды»), а также особенности
тарификации данной услуги (графы «Способ снятия» и «Условие»).



.. image:: _images/tarif_ps_2.png
    :alt: tarif_ps_2


Периодические услуги



Стоимость услуги может списываться со счета абонента единоразово в конце
периода (AT_END), в начале периода (AT_START) или ежечасно равными долями на
протяжении периода (GRADUAL). Логика системы позволяет ограничить снятие
средств со счета в зависимости от его состояния. Для этого в графе «Условие»
выбираются варианты «При любом балансе» (по умолчанию), «При положительном
балансе» и «При отрицательном балансе». При этом нулевой баланс («0» на
лицевом счете) система считает положительным. Поле "Начало списаний" служит
для указания момента времени, с которого данная услуга должна начать
действовать.



Приведём несколько примеров поведений системы, в которых отражается суть поля
"Начало списаний":

Расчётный период с началом при активации тарифного плана

1. В существующий тарифный план добавляется новая услуга. Списания должны
    произвестись у всех абонентов с начала расчётного периода. - Система
    произведёт списания с начала текущего расчётного периода, который у всех
    абонентов будет разным.

2. В существующий тарифный план добавляется новая услуга. Списания должны
    произвестись с фиксированной указанной даты. - Система начнёт списания у
    всех абонентов с указанной даты. Если указанная дата меньше текущей -
    списания будут произведены с указанной даты, но не ранее чем абонент был
    подключен на данный тарифный план.

Расчётный период фиксированной датой начала (к примеру 1 числа каждого
месяца)

1. В существующий тарифный план добавляется новая услуга. Списания должны
    произвестись у всех абонентов с начала расчётного периода. - система
    произведёт списания по периодчиеской услуге с начала текущего расчётного
    периода(с 1 числа текущего месяца) по текущую дату и далее продолжит
    списания в обычном цикле.

2. В существующий тарифный план добавляется новая услуга. Списания должны
    произвестись с фиксированной указанной даты. - Система начнёт списания у
    всех абонентов с указанной даты. Если указанная дата меньше текущей -
    списания будут произведены с указанной даты, но не ранее чем абонент был
    подключен на данный тарифный план.



Как правило, указание даты начала списаний используется только в случае ввода
новой услуги. К примеру списание за доступ к IPTV серверу, который будет
доступен только с 1 числа следующего месяца. Следует обратить внимание на то,
что если начало выбранного расчётного периода с типом списания AT_START
меньше даты начала списаний - списание за неё в данном расчётном периоде
произведено не будет.



При удалении периодической услуги из состава тарифного плана, пользователям
не будут возвращаться cписанные средства.



По умолчанию система производит списание по периодическим услугам со способом
снятия GRADUAL каждый час, то есть 24 раза в сутки. Количество списаний в
сутки можно изменить, отредактировав параметр transaction_number = 24 в файле
настроек биллинг-системы ebs_config.ini.



Внимание! Параметр нельзя изменять после запуска биллинг-системы в
эксплуатацию, так как это приведёт к неправильным расчётам по периодическим
услугам в текущем расчётном периоде (изменится промежуток списаний и,
соответственно, сумма каждого списания, что приведет к излишку или недостатку
списанных средств).



Количество средств, которые должны быть списаны единовременно, определяет
формула:



cash_summ=(n*ps_cost)/delta



transaction_number – количество списаний в сутки;

n=86400/transaction_number – промежутки времени в секундах, через которые
производятся списания;

ps_cost – стоимость периодической услуги за расчётный период;

delta – длительность расчётного периода в секундах.



Вкладка «Лимиты»



Элементы вкладки «Лимиты» становятся доступны для изменения, если на вкладке
«Общее» установлен флажок «Лимиты». В таблице устанавливаются абсолютные
ограничения по трафику (графа «МБ») для расчетного периода (графа «Период») и
выбранных групп трафика (графа «Группа»).



При превышении установленного лимита пользователь может быть заблокирован или
ограничен в скорости. Необходимая операция задается в графе «Действие». Если
выбрано ограничение скорости, максимальная её величина указывается в графе
«Скорость».



Если установлен флажок «За последний», то это означает, что концом расчётного
периода будет считаться время проверки на превышение лимита, а началом –
текущее время минус продолжительность выбранного расчётного периода. В общем
случае параметр можно интерпретировать как «За последний расчётный период»:
за последний месяц, последние 24 часа, за последние сутки, за последние 10
минут и т.д.



.. image:: _images/tarif_limit.png
    :alt: tarif_limit




Примеры



1. Флажок «За последний» не установлен, выбран расчётный период «Месяц с
    началом 1 числа каждого месяца». Тогда счётчик трафика для выбранной
    группы классов сбросится 1 числа следующего за текущим месяца. В случае
    превышения лимита 20 числа месяца, пользователь будет заблокирован (или
    его скорость будет ограничена) до перехода на новый расчётный период.



2. Флажок установлен, выбран расчётный период «Месяц с началом 1 числа
    каждого месяца». В этом случае, если пользователь за последний месяц
    (берётся в расчёт не время начала расчётного периода, а только его
    продолжительность) выбрал трафика больше, чем указано в лимите, он будет
    заблокирован до тех пор, пока трафик по группе классов за последний месяц
    не окажется меньше указанной в лимите.



Вкладка «Подключаемые услуги»

.. image:: _images/tarif_addonservice.png
    :alt: tarif_addonservice


Список подключаемых услуг для тарифного плана



На данной вкладке задаётся список доступных для подключения подключаемых
услуг и ограничения на количество подключения в общем или на указанный
расчётный период.

Таким образом можно ограничить количество активацией услуги по блокировке
лицевого счёта абонента на определённый период времени.





4.15.2.1.1 Особая конфигурация RADIUS атрибутов
===============================================


Начиная с версии 1.2 в ExpertBilling появилась возможность указывать
дополнительные RADIUS атрибуты.

Для требуется выбрать уже созданный тарифный план и на панели инстурментов
кликнуть кнопку "Дополнительные RADIUS атррибуты"



.. image:: _images/custom_radius_attrs.png
    :alt: custom_radius_attrs


Настройка дополнительных RADIUS аттрибутов для тарифного плана



Обратите внимание: RADIUS атрибуты, которые будут здесь указаны, должны быть
перечислены в одном из RADIUS словарей в папке dicts/ биллинг-системы. Список
всех используемых словарей указывается в секции [radius] файла ebs_config.ini
в опции dict_list. При указании новых словарей требуется перезапуск демона
rad. После перезапуска проверьте лог-файл rad_log на предмет отсутствия
ошибок.



Обратите внимание: в поле Attr ID необходимо указывать идентификатор
атрибута, а не его буквенное представление





4.15.2.2 Пользователи
=====================


Окно «Профиль аккаунта»



Кнопка «Сохранить» используется для принятия и сохранения сделанных
изменений. Кнопка «+» позволяет присвоить пользовательской учетной записи
новый тарифный план (из числа активных), указать период, на протяжении
которого не будет списываться со счета стоимость периодических услуг,
добавить подключаемые услуги.. Кнопка «–» удаляет выбранную строку.





.. image:: _images/account_profile.png
    :alt: account_profile


Профиль аккаунта



На главной вкладке «Общее» приводится необходимая учетная информация о
пользователе, а также задается ряд технических параметров.



Группа «Учётные данные» – имя пользователя (логин) и пароль. При нажатии на
кнопку «#» рядом с соответствующим полем, происходит автоматическая генерация
случайного логина либо 8-символьного пароля.  Эти поля обязательны для
заполнения.



Обратите внимание: не рекомендуется использовать в качестве имени символы
алфавита, отличного от английского.



В группах «Информация о пользователе» и «Адрес» приводятся дополнительные
сведения о пользователе: фамилия, имя и отчество, паспортные данные, адрес
проживания и электронный адрес. Данные поля необязательны для заполнения, но
требуются для формирования документов.



Группа «Юридическое лицо» – в этом блоке при установке соответствующего
флажка можно указать различную информацию о пользователе-юридическом лице:
название организации, её юридический адрес, телефон-факс, расчетный счет,
ОКПО, УНП и информацию о банке. Данные поля необязательны для заполнения, но
требуются для формирования документов.



Обратите внимание: информация о банке обязательна для заполнения в случае,
если установлен флажок «Юридическое лицо».



В группе «Информация о балансе» приводится значение баланса лицевого счета
клиента и указывается максимальная величина кредита, то есть количества
средств, на которые пользователь может «уйти в минус» с сохранением
доступности услуг.



В группе «Договор» отображается дата подключения и номер.



Обратите внимание: при создании нового пользователя до его сохранения, печать
договора не доступна.



Статус абонента («Активен»/«Не активен, списывать периодические услуги»/«Не
активен, не списывать периодические услуги») определяет возможность
использования услуг доступа. Если учетная запись имеет неактивный статус, то
пользователь не сможет авторизоваться на сервере. Неактивный пользователь в
таблице выделяется серым цветом.



Вкладка «Сетевые параметры»



На вкладке «Сетевые параметры» указывается ряд технических параметров,
определяющих особенности доступа абонента в рамках тарифного плана.



.. image:: _images/account_profile_network.png
    :alt: account_profile_network






В выпадающем списке «Идентификатор сервера доступа» можно выбрать сервер
доступа, посредством которого пользователю будут предоставляться услуги.
Добавление, настройка и удаление идентификаторов серверов доступа
производится в разделе «Серверы доступа».



Обратите внимание: при смене сервера доступа у абонента, подключённого на
IPN-тариф, после сохранения изменений вам необходимо вручную добавить его на
сервер доступа через контекстное меню в списке пользователей.



В группе «IPN IP адрес» указывается информация о присваиваемых пользователю
или необходимых для получения доступа к услугам сетевых параметрах. В поле
«Текущий IP адрес» указывается сетевой IP адрес компьютера клиента. Это поле
обязательно для заполнения в случае, если клиент работает на тарифном плане,
предусматривающем доступ по IPN. Данное поле разрешает ввод блока адресов в
виде 192.168.0.1/30, 10.10.1.0/24 и т.д.



Вы можете в полуавтоматическом режиме выдать пользователю нужный IP адрес из
пула. Для этого необходимо выбрать нужный пул в выпадающем списке справа от
кнопки «Выдать из пула» и нажать саму кнопку. В список доступных для выбора
IP адресов из пула не входят уже назначенные другим абонентам IP адреса, даже
если они выданы не из пула.



При включении опции «Привязать PPTP автризацию к IPN IP» абонент не сможет
авторизироваться на сервере доступа в том случае, если его текущий IP адрес
компьютера будет отличен от значения в поле "Текущий IP адрес"



Поле «Аппаратный адрес» не обязательно для заполнения. Оно может
использоваться в качестве ACL-параметра и для жесткой привязки аккаунта к
определённому MAC-адресу сетевой карты (способ доступа PPPOE). Если
планируется использовать сервер доступа как DHCP-сервер с авторизацией на
биллинг-системе, необходимо установить флажок «Выдавать IP адрес с помощью
DHCP». В этом случае при запросе на получение IP-адреса и совпадении
MAC-адреса клиента с указанным аппаратным адресом, пользователю будет выдан
IP-адрес («Текущий IP адрес») и установлена  с маской подсети 255.255.255.0.



Длительность DHCP-аренды устанавливается в файле ebs_config.ini в папке с
Expert Billing System, название параметра – session_timeout.



Обратите внимание: при использовании DHCP IP-адрес будет выдаваться
пользователю вне зависимости от того, попадает ли момент запроса на получение
адреса в разрешённый период тарификации на данном тарифном плане.



В поле «VPN IP адрес» указывается адрес, присваиваемый пользователю в случае
успешной авторизации на RADIUS-сервере на PPTP/PPPOE тарифных планах. Адрес
может быть выдан администратором из пула.



В группе «Параметры доступа» флажками устанавливаются дополнительные
ограничения/разрешения для пользователя.



"Выдавать IP адрес с помощью DHCP" - отвечает за активацию данной функции.



"Привязать PPTP авторизацию к IPN IP" - включает привязку логина абонента к
сетевому IP адресу на PPTP тарифных планах

"Привязать PPPOE авторизацию к MAC" - включает привязку логина абонента к MAC
адресу сетевой карты на PPPOE тарифных планах



«Разрешить пользоваться веб-кабинетом» – при установке данного флажка
пользователь получает возможность доступа в свой специализированный личный
раздел на сайте провайдера, веб-кабинет.



«Разрешить активировать карты экспресс-оплаты» – позволяет пользователю
пополнять свой лицевой счет при помощи карт экспресс-оплаты. Управление
картами и генерация серий производится в разделе «Карты экспресс-оплаты».



«Выдавать адрес по DHCP при отрицательном балансе» – разрешает выдачу
абоненту IP-адреса даже в случае отрицательного баланса лицевого счета.



«Выдавать адрес по DHCP если клиент неактивен, заблокирован или находится в
режиме простоя» – разрешает выдачу абоненту IP-адреса в случае, если он
неактивен или  заблокирован.



«Разрешить PPTP/PPPOE аутентификацию при отрицательном балансе» – разрешает
абоненту, подключающемуся по VPN, авторизоваться на RADIUS-сервере даже в
случае отрицательного баланса лицевого счета.



«Разрешить PPTP/PPPOE аутентификацию если клиент неактивен, заблокирован или
находится в режиме простоя» – разрешает абоненту, подключающемуся по VPN
авторизоваться на RADIUS-сервере, даже если он неактивен или заблокирован.



Поля «Индивидуальные настройки скорости для VPN» и «Индивидуальные настройки
скорости для IPN»  открываются при установке соответствующих флажков и
позволяют установить гибкие условия для пользователя при его подключении по
VPN/IPN.



Данные настройки не ограничиваются сверху соответствующими лимитами скорости
для тарифа в целом и параметрами подключаемых услуг.



Обратите внимание: в версии ExpertBilling 1.2 изменился принцип указания
выходящей и исходящей скорости для абонента. На всех тарифных планах, не
зависимо от их типов, входящая и исходящая указывается относительно абонента.



Для индивидуальной настройки cкорости при работе по VPN/IPN используется
специальная форматная строка:



rx-rate[/tx-rate] [rx-burst-rate[/tx-burst-rate] [rx-burst-threshold[/tx-
burst-threshold] [rx-burst-time[/tx-burst-time] [priority] [rx-rate-min[/tx-
rate-min]]]]

Все направления приводятся со стороны абонента. Все скорости указываются в
битах. Если не приведен параметр tx-rate, то он принимается равным rx-rate.
Аналогичное правило действует  для  параметров tx-burst-rate, tx-burst-
threshold и tx-burst-time. Если параметры rx-burst-threshold и tx-burst-
threshold не приведены (но задан параметр burst-rate), то rx-rate и tx-rate
будут приняты в качестве соответствующих пороговых значений. Если не указаны
параметры rx-burst-time и tx-burst-time, по умолчанию используется значение 1
секунда. Значение рriority может быть выбрано из диапазона 1..8, где 1
означает наивысший и 8 – низший приоритет. Если параметры rx-rate-min и tx-
rate-min не указаны, то вместо них используются значения rx-rate и tx-rate.
Значения rx-rate-min и tx-rate-min не могут превышать rx-rate и tx-rate.



Для того чтобы у пользователя появилась возможность выхода на пиковую
скорость, необходимо указать все три параметра серии: burst-time, burst-
threshold и burst-rate. В случае, когда средняя скорость работы пользователя
за время burst-time не превышает определенный порог burst-threshold,
максимальная скорость пользователя увеличивается до пиковой (burst-rate) до
тех пор, пока средняя скорость за burst-time не превысит burst-threshold.
Эта возможность «поощряет» пользователя за неполную загрузку канала
(например, при веб-серфинге) либо пользовании другими низкоскоростными
сервисами.



Например, для ограничения скорости канала до 256 Кбит/с на прием и 128 Кбит/с
на передачу, максимального приоритета и пиковой кратковременной скорости 512
Кбит/с на 10 секунд при пороге 384 Кбит/с, минимальная скорость – 10 Кбит/с,
надо ввести в поле «Индивидуальные настройки скорости для VPN» строку:



128000/256000 512000/512000 384000/384000 10/10 1 10000/10000



802.1x



В ExpertBilling 1.2 появилась возможность авторизации на порту коммутатора
посредством протокола EAP-MD5. За параметры авторизации отвечает группа
настроек 802.1x.



В поле "NAS" указывается сервер доступа(коммутатор), к которому подключен
абонент.

В поле "Порт" указывается физический номер порта, к которому подключен
абонент. Если порт не указан - этот параметр указываться не будет.

Настройки "Авторизация по паролю"/"Авторизация по MAC" отвечают за тип
авторизации. Если выбрана авторизация по паролю - абонент должен будет для
авторизации на коммутаторе ввести своё имя и пароль. В случае авторизации по
MAC система будет проверять на соответствие его текущего мак-адреса
мак-адресу в биллинг-системе. В этом случае от пользователя потребуется
ввести любое имя и пароль.

Если поля "VLAN Accept" и "VLAN Reject" заполнены, то после успешной
авторизации абонент будет перемещён в VLAN с id=VLAN Accept, в случае
неудачной авторизации в VLAN Reject. В случае использования авторизации по
MAC, если MAC адрес абонента не найден в базе данных биллинг-системы и если в
опции файла нстроек ebs_config.ini параметр bad_8021x_users_vlan отличен от
-1, абонент будет перемещён в указанный VLAN. Если bad_8021x_users_vlan = -1,
пользователю будет сообщено о неудавшейся авторизации.





Вкладка «Не списывать ПУ»



На данной вкладке настраивается расписание периодов, во время которых с
лицевого счета данного абонента не будет производиться списание средств по
периодическим услугам. Вместо требуемых сумм в истории операций будут указаны
нулевые значения.



.. image:: _images/susp_period.png
    :alt: susp_period


Добавление нового периода без периодических услуг



Период ограничивается по дате и времени (например, «с 00:00 01.01.2008 по
23:59 31.12.2008»).



Вкладка «Тарифные планы»



На данной вкладке определяется расписание по переводу пользователя на
различные тарифные планы. Добавление и удаление строк в расписании
производится с помощью кнопок «+» и «–».



.. image:: _images/account_tarif.png
    :alt: account_tarif




Окно «Редактирование плана» открывается по нажатию кнопки «+». В поле
«Тарифный план» выбирается тарифный план, на который будет осуществлен
перевод, а в поле «Дата и время» указывается точное время и дата данного
события.

Поле "Расчётный период закрыт" означает, что по всем периодическим услугам(в
том числе и по подключаемым услугам) были произведены окончательные расчёты.

Возможность смены ТП применяется, например, в случаях, когда необходимо
изменить дату расчётов с пользователем. Для этого следует «перевести»
пользователя на тот же самый тариф, но с другой, нужной даты.  В таком случае
пользователю будет начислен трафик и/или время, а также произведены остальные
действия, которые выполняются в момент подключения пользователя на тарифный
план.



Вкладка «Подключаемые услуги»



На этой вкладке производится управление подключаемыми услугами абонента.



.. image:: _images/account_addonservice.png
    :alt: account_addonservice


Подклюачемые услуги абонента



Поле "Активирована на сервере доступа" отражает выполнена ли на сервере
доступа команда активации услуги(только для услуг, использующих команды для
активации услуг).

Поле "Временная блокировка" позволяет временно приостановить действие
подключаемой услуги.



При добавлении сразу двух подключаемых услуг, оперирующих скоростью, система
будет производить списания по обеим, однако настройки скорости будут взяты из
первой. Не рекомендуется поступать данным образом.





