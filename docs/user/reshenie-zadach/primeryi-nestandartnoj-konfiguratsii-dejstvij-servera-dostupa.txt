
.. _reshenie-zadach-primeryi-nestandartnoj-konfiguratsii-dejstvij-servera-dostupa:

===============================================================
6.1 Примеры нестандартной конфигурации действий сервера доступа
===============================================================


Система ExpertBilling позволяет гибко управлять серверами доступа посредством
настраиваемых шаблонов действий. Рассмотрим пример нестандартной конфигурации
шаблонов для управления сервером доступа.



В разделе, посвящённом настройке серверов доступа, приведён пример
блокирования клиентов при отключении.



Другим альтернативным подходом является перенаправление пользователя на 80
порт существующего веб-сервера, который покажет ему страницу с сообщением о
недостатке средств или отключении.



Перед началом убедитесь, что ваш веб-сервер корректно отображает эту страницу
и что она доступна по адресу http://192.168.1.1/ (измените на нужный).



Для начала разрешим доступ к услугам всем абонентам, IP адреса которых
находятся в AddressList internet_users:



/ip firewall filter add chain=forward src-address-list=internet_users
action=accept
/ip firewall filter add chain=forward dst-address-list=internet_users
action=accept



Всем остальным запретим forwarding:



/ip firewall filter add chain=forward action=drop

Сейчас все запросы  на 80 порт по протоколу TCP от IP адресов, не входящих в
AddressList internet_users перенаправим на адрес веб-сервера



/ip firewall nat add chain=dstnat src-address-list=!internet_users
protocol=tcp dst-port=80 action=dst-nat to-addresses=192.168.1.1 to-ports=80

/ip firewall nat add chain=srcnat src-address-list=internet_users
action=masquerade



Все запросы от неизвестных/заблокированных клиентов будут перенаправляться на
веб-сервер, который покажет указанное вами на странице сообщение.



