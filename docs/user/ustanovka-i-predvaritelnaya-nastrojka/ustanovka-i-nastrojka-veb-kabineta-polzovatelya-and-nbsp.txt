
.. _ustanovka-i-predvaritelnaya-nastrojka-ustanovka-i-nastrojka-veb-kabineta-polzovatelya-and-nbsp:

===================================================
3.6 Установка и настройка веб-кабинета пользователя
===================================================


Рассмотрена установка веб-кабинета для ОС Debian/Ubuntu.



1. Установим необходимые пакеты



apt-get install apache2 libapache2-mod-python python-psycopg2 pyro python-
dateutil python-pytils python-crypto python-twisted

2. Установим Django

mkdir /opt/ebs/web/
cd /opt/ebs/web



Для получения свежей версии Django воспользуйтесь командой

wget `UNREGISTERED EVALUATION VERSION`_

.. _UNREGISTERED EVALUATION VERSION:
    http://www.djangoproject.com/download/1.0.2/tarball/

tar -xvzf Django-1.0.2-final.tar.gz
cp -r Django-1.0.2-final/django /opt/ebs/web/
rm -rf Django-1.0.2-final.tar.gz

3. Установка веб-кабинета



Копируем архив с кабинетом в папку /opt/ebs/web/:



cp -r /opt/ebs/data/ebscab/ebscab /opt/ebs/web/



4. Настройка кабинета



Укажите параметры подключения к базе данных

DATABASE_ENGINE = 'postgresql_psycopg2'
DATABASE_NAME = 'ebs'
DATABASE_USER = 'ebs'
DATABASE_PASSWORD = 'ebspassword'
DATABASE_HOST = '127.0.0.1'
DATABASE_PORT = '5432'

Правильную временную зону(http://www.postgresql.org/docs/8.1/static/datetime-
keywords.html#DATETIME-TIMEZONE-SET-TABLE)

TIME_ZONE = 'Europe/Minsk'

Путь к медиафайлам

MEDIA_ROOT = '/opt/ebs/web/ebscab/media'

Путь к директории с файлами шаблонов



TEMPLATE_DIRS = (

  '/opt/ebs/web/ebscab/templates',

)



В ExpertBilling 1.2 появилась возможность использовать услугу "Обещанный
платёж". Параметры этой услуги для абонентов настроаиваются здесь же
нижеследующими опциями.



ALLOW_PROMISE = True #разрешить использование услуги

MAX_PROMISE_SUM = 100000 #максимальная сумма, которую абонент может взять в
долг

LEFT_PROMISE_DAYS = 7 # Количество дней, по истечению которых с абонента
будет взыскана взятая в долг сумма.



Настройка валюты отображения происходит через переменную CURRENCY.



5. Настройка Apache



Пропишите в файле /etc/apache2/sites-available/default следующие строки:



<VirtualHost *:80>

       ServerAdmin webmaster@localhost

       #ServerName www.ebscab.ru

       DocumentRoot /opt/ebs/web/ebscab



   <Location "/">

       SetHandler python-program

       PythonHandler django.core.handlers.modpython

       SetEnv DJANGO_SETTINGS_MODULE ebscab.settings

     PythonDebug On

       PythonPath "['/opt/ebs/web','/opt/ebs/web/ebscab'] + sys.path"

   </Location>



   <Location "/media">

       SetHandler None

   </Location>



   <Location "/admin_media">

       SetHandler None

   </Location>



   Alias /admin_media /opt/ebs/web/django/contrib/admin/media/

   <Directory /opt/ebs/web/django/contrib/admin/media/>

       Order allow,deny

       Allow from all

   </Directory>

   Alias /media /opt/ebs/web/ebscab/media/

   <Directory /opt/ebs/web/ebscab/media/>

       Order allow,deny

       Allow from all

   </Directory>



   <LocationMatch "\.(jpg|gif|png)$">

       SetHandler None

   </LocationMatch>

   CustomLog /opt/ebs/web/access.log combined

   ErrorLog /opt/ebs/web/error.log

</VirtualHost>





<server ip> - замените на IP адрес сервера или *, если веб-кабинет должен
быть доступен со всех IP адресов

Теперь необходимо перезапустить Apache командой



/etc/init.d/apache2 restart



Теперь можно попробовать открыть веб-кабинет по адресу, указанному в
конфигурационном файле Apache. Если возникнут проблемы, обратитесь к файлу
/opt/ebs/web/error.log







