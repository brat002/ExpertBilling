<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <title>Установка серверной части системы</title>
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <meta http-equiv="Content-Style-Type" content="text/css" />
   <link type="text/css" href="default.css" rel="stylesheet" />
<script type="text/javascript" src="helpman_topicinit.js"></script></head>
<body style="margin: 0px 0px 0px 0px; background: #FFFFFF;">
<div id="hmpopupDiv" style="visibility:hidden; position:absolute; z-index:1000; "></div>


<table width="100%" border="0" cellspacing="0" cellpadding="5" bgcolor="#C0C0C0">
  <tr valign="middle">
    <td align="left">
      <p class="par3"><span class="fnt4">Установка серверной части системы</span></p>

    </td>
    <td align="right">
     <span style="font-size: 9pt">
     <a href="chapter_2.html">Top</a>&nbsp;
     <a href="overview.html">Previous</a>&nbsp;
     <a href="new_item7.html">Next</a>
     </span>
    </td>
  </tr>
</table>


<!-- Placeholder for topic body. -->
<table width="100%" border="0" cellspacing="0" cellpadding="5"><tr valign="top"><td align="left">
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Для установки системы необходим сервер на базе ОС Linux. Необходимые зависимости:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">postgresql-8.3</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">postgresql-common</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">postgresql-contrib</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">ssh</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Также настоятельно рекомендуется установить системную локаль в ru_RU.UTF-8. </span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Описание установки серверной части системы на другие серверы доступа выходит за рамки этого руководства – обратитесь к руководству пользователя соответствующего сервера доступа. </span></p>
<p style="text-align: justify; text-indent: 24px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Рассмотрим установку серверной части Expert Billing System на примере Debian Lenny.</span></p>
<p style="text-align: justify; text-indent: 24px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">1. Создаём необходимую структуру директорий </span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">mkdir /opt/ebs</span><br />
<span class="fnt1">mkdir /opt/ebs/data/&nbsp;</span><br />
<span class="fnt1">cd /opt/ebs/data</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">2. Копируем в этот каталог архив с биллингом и распаковываем его</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">tar -xzvf ebs-1.03.tar.gz</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">2. Создаем пользователя:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">adduser ebs</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Пароль – ebsuser (можно изменить на желаемый)</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">3. Создаем базу данных (БД):</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">apt-get install postgresql-8.3 postgresql-contrib-8.3&nbsp;</span></p>
<p class="par1"><span class="fnt1">su postgres</span><br />
<span class="fnt1">createuser -P –s ebs</span><br />
<span class="fnt1">createdb –O ebs ebs</span></p>
<p class="par1"><span class="fnt1">exit</span></p>
<p class="par1"><span class="fnt1">su ebs</span><br />
<span class="fnt1">psql ebs -f /usr/share/postgresql/8.3/contrib/_int.sql</span><br />
<span class="fnt1">psql ebs –f /usr/share/postgresql/8.3/contrib/int_aggregate.sql</span></p>
<p class="par1"><span class="fnt1">exit</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman'; font-weight: bold; color: #ff0000; text-decoration: underline;">Обратите внимание:</span><span style="font-size: 16px; font-family: 'Times New Roman';"> в том случае, если вы используете более новую версию СУБД PostgreSQL, пути к библиотекам у вас могут выглядеть соответственно </span></p>
<p class="par1"><span class="fnt1">psql ebs -f /usr/share/postgresql/8.4/contrib/_int.sql</span></p>
<p class="par1"><span class="fnt1">psql ebs -f /usr/share/postgresql/8.4/contrib/int.sql</span></p>
<p class="par1"><span class="fnt1">psql ebs –f /usr/share/postgresql/8.4/contrib/int_aggregate.sql</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman'; font-weight: bold; color: #ff0000; text-decoration: underline;">Обратите внимание:</span><span style="font-size: 16px; font-family: 'Times New Roman';"> база данных СУБД PostgreSQL по умолчанию находится в каталоге /var/. Рекомендуется эту точку монтирования вынести на отдельный раздел, а также предоставить ей максимальное количество дискового пространства, либо выделить отдельный жесткий диск.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">4. Импортируем дамп БД:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">su ebs</span><br />
<span class="fnt1">psql ebs -f /opt/ebs/data/sql/ebs_dump.sql</span></p>
<p class="par1"><span class="fnt1">psql ebs -f /opt/ebs/data/sql/changes.sql</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman'; font-weight: bold; color: #ff0000;">Обратите внимание: </span><span style="font-size: 16px; font-family: 'Times New Roman'; color: #000000;">первый файл (ebs_dump.sql) содержит схему базы данных. В файле changes.sql находятся все новые изменения, которые не попали в основной дамп. Импортирование файла chganges.sql СТРОГО обязательно. Во время импортирования возможно появление предупреждений и ошибок, о уже существующих методах или операциях. </span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">5. Прописываем скрипты инициализации:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span style="width:29px">&nbsp;</span><span class="fnt1">cp /opt/ebs/data/init.d/ebs_core /etc/init.d/ebs_core</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">cp /opt/ebs/data/init.d/ebs_rad /etc/init.d/ebs_rad</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">cp /opt/ebs/data/init.d/ebs_nf /etc/init.d/ebs_nf</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">cp /opt/ebs/data/init.d/ebs_nfroutine /etc/init.d/ebs_nfroutine</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">cp /opt/ebs/data/init.d/ebs_rpc /etc/init.d/ebs_rpc</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span style="width:29px">&nbsp;</span><span class="fnt1">update-rc.d ebs_core defaults</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">update-rc.d ebs_rad defaults</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">update-rc.d ebs_nf defaults</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">update-rc.d ebs_nfroutine defaults</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">update-rc.d ebs_rpc defaults</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">6. Настраиваем подключение к базе данных</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Открываем </span><span style="font-size: 16px; font-family: 'Times New Roman'; font-weight: bold;">ebs_config.ini</span><span style="font-size: 16px; font-family: 'Times New Roman';"> из директории с биллингом и указываем параметры для подключения к базе данных.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">7. Производим тестовый запуск Expert Billing Admin</span><br />
<span style="font-size: 16px; font-family: 'Times New Roman';">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Запустим RPC сервер:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span style="width:29px">&nbsp;</span><span class="fnt1">cd /opt/ebs/data/</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">./rpc&nbsp;</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Сейчас откройте EBSClient, укажите IP-адрес сервера с биллингом, имя admin, пароль admin, и попробуйте подключиться.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">8. Настройка сервера доступа</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Для начала необходимо настроить экспорт сетевой статистики на сервере доступа под управлением MikroTik следующим образом:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_030.png" width="276" height="636" alt="ebs_030" style="border:none" /></p>
<p style="text-align: center;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_031.png" width="360" height="301" alt="ebs_031" style="border:none" /></p>
<p style="text-align: center;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_032.png" width="306" height="304" alt="ebs_032" style="border:none" /></p>
<p style="text-align: center;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">/ip traffic-flow set enabled=yes</span><br />
<span class="fnt1">/ip traffic-flow target add disabled=no version=5 address=</span><span class="fnt1" style="font-style: italic; font-weight: bold;">&lt;адрес &nbsp;сервера с биллингом&gt;</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">9. Включаем RADIUS-авторизацию</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span class="fnt1">/radius add address=</span><span class="fnt1" style="font-style: italic; font-weight: bold;">&lt;IP сервера с билингом&gt;</span><span class="fnt1">&nbsp;secret=123 service=ppp timeout=1000</span></p>
<p style="text-align: justify; text-indent: 47px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Для включения RADIUS авторизации PPTP/PPPOE/DHCP-сессий необходимо:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 24px;"><table cellpadding="0" cellspacing="0" style="line-height: normal;"><tr style="vertical-align:baseline"><td style="width:24px"><span style="font-size: 16px; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000;">&#8226;</span></td><td><span style="font-size: 16px; font-family: 'Times New Roman';">Добавить новый PPP-профиль</span></td></tr></table></div><p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><img src="ebs_040.png" width="700" height="565" alt="ebs_040" style="border:none" /></p>
<p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 24px;"><table cellpadding="0" cellspacing="0" style="line-height: normal;"><tr style="vertical-align:baseline"><td style="width:24px"><span style="font-size: 16px; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000;">&#8226;</span></td><td><span style="font-size: 16px; font-family: 'Times New Roman';">Включить PPTP-сервер с созданным профилем </span></td></tr></table></div><p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><img src="ebs_041.png" width="700" height="481" alt="ebs_041" style="border:none" /></p>
<p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 24px;"><table cellpadding="0" cellspacing="0" style="line-height: normal;"><tr style="vertical-align:baseline"><td style="width:24px"><span style="font-size: 16px; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000;">&#8226;</span></td><td><span style="font-size: 16px; font-family: 'Times New Roman';">Включаем RADIUS авторизацию и аккаунтинг для PPTP </span></td></tr></table></div><p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><img src="ebs_042.png" width="700" height="384" alt="ebs_042" style="border:none" /></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><img src="ebs_044.png" width="743" height="582" alt="ebs_044" style="border:none" /></p>
<p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<div style="text-align: justify; text-indent: 0px; padding: 0px 0px 0px 0px; margin: 0px 0px 0px 24px;"><table cellpadding="0" cellspacing="0" style="line-height: normal;"><tr style="vertical-align:baseline"><td style="width:24px"><span style="font-size: 16px; font-family: 'Arial Unicode MS', 'Lucida Sans Unicode', 'Arial'; color: #000000;">&#8226;</span></td><td><span style="font-size: 16px; font-family: 'Times New Roman';">Меняем идентификатор сервера доступа на MikroTik_NAS. </span></td></tr></table></div><p style="text-align: justify; text-indent: -24px; margin: 0px 0px 0px 48px;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center; text-indent: -24px; margin: 0px 0px 0px 48px;"><img src="ebs_045.png" width="480" height="664" alt="ebs_045" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">10. Включаем DHCP-сервер (только в случае если планируется использовать MikroTik для выдачи IP-адресов с авторизацией на биллинг-системе) </span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_050.png" width="261" height="736" alt="ebs_050" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_051.png" width="661" height="376" alt="ebs_051" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">11. Создаем системного пользователя </span><span style="font-size: 16px; font-family: 'Times New Roman'; font-style: italic;">ebs</span><span style="font-size: 16px; font-family: 'Times New Roman';"> с паролем </span><span style="font-size: 16px; font-family: 'Times New Roman'; font-style: italic;">ebspassword </span><span style="font-size: 16px; font-family: 'Times New Roman';">или любым другим:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_060.png" width="721" height="567" alt="ebs_060" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">12. Настраиваем файервол:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Разрешим серверу доступа пропускать через себя пакеты на адреса виртуальной сети и запретим всё остальное:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span style="width:29px">&nbsp;</span><span class="fnt1">/ip &nbsp;firewall filter add src-address=192.168.12.0/24 action=accept</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">/ip &nbsp;firewall filter add dst-address=192.168.12.0/24 action=accept</span><br />
<span style="width:29px">&nbsp;</span><span class="fnt1">/ip &nbsp;firewall filter add action=drop</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Если клиентам не будут выдаваться реальные IP-адреса, необходимо настроить NAT или MASQUERADING. Создаем правило:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p class="par1"><span style="width:29px">&nbsp;</span><span class="fnt1">/ip firewall nat add src-address=192.168.12.0/24 action=masquerade</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman'; font-weight: bold; color: #ff0000; text-decoration: underline;">Обратите внимание:</span><span style="font-size: 16px; font-family: 'Times New Roman';"> в целях безопасности рекомендуется разрешить взаимодействие сервера с биллингом только с сервером (серверами) доступа, компьютером администратора и компьютером кассира, а также открыть 80 порт для корректной работы веб-кабинета.</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">13. Производим настройку кэширующего DNS-сервера:</span></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_070.png" width="259" height="593" alt="ebs_070" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: center;"><img src="ebs_071.png" width="486" height="324" alt="ebs_071" style="border:none" /></p>
<p style="text-align: justify;"><span style="color: #000000;">&nbsp;</span></p>
<p style="text-align: justify;"><span style="font-size: 16px; font-family: 'Times New Roman';">Установка завершена.</span></p>
<hr noshade="noshade" size="1" /><p>This help file was created with an unregistered evaluation copy of Help &amp; Manual. © EC Software. All rights reserved. This message will not appear if you compile this help file with the registered version of Help &amp; Manual.</p>

</td></tr></table>

</body>
</html>
