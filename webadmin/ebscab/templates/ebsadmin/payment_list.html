{% extends "ebsadmin/base.html" %}
{% load i18n %}
{% load ebsadmin_tags %}
{% load crispy_forms_tags %}
{% block extra_head %}

        <script type="text/javascript"> 
        $(document).ready(function() {
            $(".open-custom-dialog").click(function(event) {
                $('<div />').dialog2({
                    title: "{% blocktrans %}Изменить платёж{% endblocktrans %}", 
                    content: this.href, 
                    id: "payment-modal"
                });

                event.preventDefault(event);
            });
            $(".show-confirm").click(function() {
                a=$(this);
                $.fn.dialog2.helpers.confirm("{% blocktrans %}Внимание. Удаление платежа может вызвать нежелательные последствия при перетарификации. Если вы не уверены в своих действиях - лучше откажитесь от удаления.{% endblocktrans %}", {
                    confirm: function() {
                        $.getJSON(a.attr('href'),{},function(data,status){
                            if( status=='success' ){
                                if(data.status==true)
                                    {
                                    location.reload();
                                    }else{
                                        alert(data.message)
                                    }
                                
                            }else{
                                alert('{% blocktrans %}Произошла непредвиденная ошибка{% endblocktrans %}')
                            }

                        })                      
                        }, 
                    decline: function() {  }
                });

                event.preventDefault(event);
            });
            {% if table %}
            $('#tab-control a[href="#result"]').tab('show');
            {% else %}
            $('#tab-control a[href="#filter"]').tab('show');
            {% endif %}
            $("#id_daterange").daterangepicker();
        });
        
        
        </script>

{% endblock %}
{% block base %}
<legend>{% blocktrans %}Платежи через платёжные системы{% endblocktrans %}</legend>
<ul class="nav nav-tabs" id="tab-control">
  <li ><a href="#filter">{% blocktrans %}Фильтр{% endblocktrans %}</a></li>
  <li><a href="#result">{% blocktrans %}Отчёт{% endblocktrans %}</a></li>  
</ul>

 {% load render_table from django_tables2 %}
<div class="tab-content">
  <div class="tab-pane" id="filter">
  
  <div class="row-fluid">
        <div class="span12">
            <form action="{{form.action}}" method="GET" class="well form-horizontal form-condensed ">
            {{ form.non_field_errors }}
                <fieldset>

                    {{form|crispy}}
                
                </fieldset>
                <fieldset>
                    <div class="form-actions form-actions-center">
                        <button class="btn btn-primary" type="submit">{% blocktrans %}Подобрать результаты{% endblocktrans %}</button>
                    </div>
                </fieldset>
            </form>
        </div>
    </div>
  
  </div>
  <div class="tab-pane" id="result">{% if table %}{% render_table table %}{% endif %}</div>

</div>
 {% endblock %}

