{% extends "base.html" %}

{% block extrahead %}
<link type="text/css" rel="stylesheet" href="{{MEDIA_URL}}css/jquery/jquery-ui-1.7.2.custom.css" />
<script type="text/javascript" src = "{{MEDIA_URL}}js/jquery.js"></script>
<script language="JavaScript" type="text/javascript" src="{{MEDIA_URL}}js/jquery-ui-1.7.2.custom.min.js"></script>
<script language="JavaScript" type="text/javascript" src="{{MEDIA_URL}}js/json2.js"></script>
<script src="{{MEDIA_URL}}js/static/Orbited.js"></script>
<script>
TCPSocket = Orbited.TCPSocket
</script>
<script src="{{MEDIA_URL}}js/static/protocols/stomp/stomp.js"></script>
<script src="{{MEDIA_URL}}js/ajaxroutine.js"></script>

<script>

	jQuery(document).ready(function(){
		 stomp = new STOMPClient();
		 stomp.onopen = function() {
    	 };
    	stomp.onclose = function(c) { alert('Lost Connection, Code: ' + c);};
    	stomp.onerror = function(error) {
    	    alert("Error: " + error);
	    };
	    stomp.onerrorframe = function(frame) {
    	    alert("Error: " + frame.body);
    	};
    	stomp.onconnectedframe = function() {
        	stomp.subscribe("/test/");
    	};
    	stomp.onmessageframe = function(frame) {
        	alert('asd')
    	};
    	stomp.connect('localhost', 61613);

		
		{% for departament in departaments %}
		jQuery("#departament_{{departament.id}}").accordion()
		{% endfor %}
	})
	
</script>
{% endblock %}

{% block content %}
<div id="content_tickets">
{% for departament in departaments %}
<div id="departament_{{departament.id}}">
<h4>{{departament.name}}</h4>
<div>
	<table cols=10 cellpadding=0 cellspacing=0 width=100%>
		<tr>
			<th>№</th>
			<th>Статус</th>
			<th>Пользователь</th>
			<th>Тема</th>
			<th>Скрытый комментарий</th>
			<th>Кто назначил</th>
			<th>Назначен</th>
			<th>Создан</th>
			<th>В архив</th>
			<th>Удалить</th>
		</tr>
		{% for ticket in departament.get_tickets %}
		<td>{{ticket.id}}</td>
		<td>{{ticket.status}}</td>
		<td>{{ticket.created_by}}</td>
		<td>{{ticket.tittle}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td><input type='checkbox'/ name="is_archive"></td>
		<td><input type='checkbox'/  name="is_deleted"></td>
		{% endfor %}
	</table>
</div>
{% for user in departament.user.all %}
<h4>{{user.username}}</h4>
<div>
	<table cols=10 cellpadding=0 cellspacing=0 width=100%>
		<tr>
			<th>№</th>
			<th>Статус</th>
			<th>Пользователь</th>
			<th>Тема</th>
			<th>Скрытый комментарий</th>
			<th>Кто назначил</th>
			<th>Назначен</th>
			<th>Создан</th>
			<th>В архив</th>
			<th>Удалить</th>
		</tr>
		{% for ticket in user.get_tickets %}
		<td>{{ticket.id}}</td>
		<td>{{ticket.status}}</td>
		<td>{{ticket.created_by}}</td>
		<td>{{ticket.tittle}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td>{{ticket}}</td>
		<td><input type='checkbox'/ name="is_archive"></td>
		<td><input type='checkbox'/  name="is_deleted"></td>
		{% endfor %}
	</table>
</div>
{% endfor %}
</div>
{% endfor %}
</div>
{% endblock %}